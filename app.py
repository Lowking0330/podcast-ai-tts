import streamlit as st
from gradio_client import Client

# ---------------------------------------------------------
# 1. è¨­å®šèˆ‡è³‡æ–™å€ (é€™è£¡å°±æ˜¯æ‚¨è²¼ä¸Šçš„è³‡æ–™ï¼Œä½†æˆ‘å¹«æ‚¨ä¿®å¾©äº†æ ¼å¼)
# ---------------------------------------------------------

# é€™æ˜¯æ¸…æ´—éå¾Œçš„å­—å…¸ï¼Œæ ¼å¼ç‚ºæ¨™æº–çš„ List[str]
speaker_map = {
    'è³½å¾·å…‹': [
        'è³½å¾·å…‹_å¾·é¹¿è°·_å¥³è²',
        'è³½å¾·å…‹_éƒ½é”_å¥³è²',
        'è³½å¾·å…‹_å¾·å›ºé”é›…_ç”·è²',
        'è³½å¾·å…‹_å¾·å›ºé”é›…_å¥³è²',
    ],
    'å¤ªé­¯é–£': [
        'å¤ªé­¯é–£_å¥³è²',
        'å¤ªé­¯é–£_ç”·è²1',
        'å¤ªé­¯é–£_ç”·è²2',
    ],
    'è³½å¤': [
        'è³½å¤_å¥³è²',
    ],
    'å¸ƒè¾²': [
        'å¸ƒè¾²_éƒ¡ç¾¤_ç”·è²',
        'å¸ƒè¾²_å¡ç¾¤_ç”·è²',
        'å¸ƒè¾²_å·’ç¾¤_ç”·è²',
        'å¸ƒè¾²_ä¸¹ç¾¤_ç”·è²',
        'å¸ƒè¾²_å“ç¾¤_å¥³è²',
    ],
    'æ³°é›…': [
        'æ³°é›…_å››å­£_å¥³è²',
        'æ³°é›…_è³½è€ƒåˆ©å…‹_ç”·è²',
        'æ³°é›…_è¬å¤§_å¥³è²',
        'æ³°é›…_æ±¶æ°´_ç”·è²',
        'æ³°é›…_å®œè˜­æ¾¤æ•–åˆ©_å¥³è²',
        'æ³°é›…_æ¾¤æ•–åˆ©_ç”·è²',
    ],
    'é„’': [
        'é„’_å¥³è²',
    ],
    'é­¯å‡±': [
        'é­¯å‡±_å¤§æ­¦_å¥³è²',
        'é­¯å‡±_å¤šç´_ç”·è²',
        'é­¯å‡±_æ±_å¥³è²',
        'é­¯å‡±_èŒ‚æ—_ç”·è²',
        'é­¯å‡±_è¬å±±_å¥³è²',
        'é­¯å‡±_éœ§å°_å¥³è²',
    ],
    'æ’ç£': [
        'æ’ç£_ä¸­_ç”·è²',
        'æ’ç£_æ±_ç”·è²',
        'æ’ç£_åŒ—_å¥³è²',
        'æ’ç£_å—_å¥³è²',
    ],
    'é›…ç¾': [
        'é›…ç¾_å¥³è²',
    ],
    'å‘å—': [
        'å‘å—_å»ºå’Œ_å¥³è²',
        'å‘å—_å—ç‹_å¥³è²',
        'å‘å—_è¥¿ç¾¤_å¥³è²',
        'å‘å—_çŸ¥æœ¬_å¥³è²',
    ],
    'é‚µ': [
        'é‚µ_ç”·è²',
    ],
    'å™¶ç‘ªè˜­': [
        'å™¶ç‘ªè˜­_å¥³è²',
    ],
    'æ‹‰é˜¿é­¯å“‡': [
        'æ‹‰é˜¿é­¯å“‡_å¥³è²',
    ],
    'æ’’å¥‡èŠé›…': [
        'æ’’å¥‡èŠé›…_å¥³è²',
    ],
    'å¡é‚£å¡é‚£å¯Œ': [
        'å¡é‚£å¡é‚£å¯Œ_ç”·è²',
    ],
    'é˜¿ç¾': [
        'é˜¿ç¾_æµ·å²¸_ç”·è²',
        'é˜¿ç¾_æ†æ˜¥_å¥³è²',
        'é˜¿ç¾_é¦¬è˜­_å¥³è²',
        'é˜¿ç¾_å—å‹¢_å¥³è²',
        'é˜¿ç¾_ç§€å§‘å·’_å¥³è²1',
        'é˜¿ç¾_ç§€å§‘å·’_å¥³è²2',
    ],
}

# ---------------------------------------------------------
# 2. ä»‹é¢è¨­è¨ˆå€ (UI)
# ---------------------------------------------------------
st.title("è‡ºç£åŸä½æ°‘æ—èª Podcast ç”Ÿæˆå™¨ ğŸ™ï¸")
st.markdown("æ”¯æ´ 16 æ— 42 ç¨®èªéŸ³åˆæˆ")

# å»ºç«‹å…©æ¬„ä½ˆå±€
col1, col2 = st.columns(2)

with col1:
    # ç¬¬ä¸€å±¤é¸å–®ï¼šé¸æ“‡æ—ç¾¤
    selected_tribe = st.selectbox("æ­¥é©Ÿ 1ï¼šé¸æ“‡æ—ç¾¤", list(speaker_map.keys()))

with col2:
    # ç¬¬äºŒå±¤é¸å–®ï¼šæ ¹æ“šæ—ç¾¤è‡ªå‹•æ›´æ–°èªè€…
    # å› ç‚ºæˆ‘å€‘å·²ç¶“æœ‰å®Œæ•´çš„ mapï¼Œä¸éœ€è¦å†å»å• APIï¼Œç›´æ¥å¾å­—å…¸æ‹¿å°±å¥½ (é€Ÿåº¦æ›´å¿«)
    available_speakers = speaker_map[selected_tribe]
    selected_speaker = st.selectbox("æ­¥é©Ÿ 2ï¼šé¸æ“‡èªè€…", available_speakers)

# æ–‡å­—è¼¸å…¥æ¡†
text_input = st.text_area("æ­¥é©Ÿ 3ï¼šè¼¸å…¥è¦åˆæˆçš„æ–‡å­—", height=150, placeholder="è«‹è¼¸å…¥æ—èªæ–‡å­—...")

# ---------------------------------------------------------
# 3. é‚è¼¯åŸ·è¡Œå€ (Logic)
# ---------------------------------------------------------
if st.button("é–‹å§‹ç”ŸæˆèªéŸ³", type="primary"):
    if not text_input:
        st.warning("è«‹å…ˆè¼¸å…¥æ–‡å­—ï¼")
    else:
        try:
            with st.spinner(f"æ­£åœ¨ç”Ÿæˆ {selected_speaker} çš„è²éŸ³ï¼Œè«‹ç¨å€™..."):
                # åˆå§‹åŒ– Client
                client = Client("https://hnang-kari-ai-asi-sluhay.ithuan.tw/")
                
                # ç›´æ¥å‘¼å«åˆæˆç«¯é»
                # æ ¹æ“šæ‚¨çš„ Logï¼Œåˆæˆç«¯é»æ˜¯ /default_speaker_tts
                result = client.predict(
                    ref=selected_speaker,      # èªè€… ID
                    gen_text_input=text_input, # è¼¸å…¥æ–‡å­—
                    api_name="/default_speaker_tts"
                )
                
                # result é€šå¸¸æ˜¯éŸ³æª”çš„è·¯å¾‘
                st.success("ç”ŸæˆæˆåŠŸï¼")
                st.audio(result)
                
        except Exception as e:
            st.error(f"ç”Ÿæˆå¤±æ•—ï¼ŒéŒ¯èª¤è¨Šæ¯ï¼š{e}")
            # å¦‚æœå¤±æ•—ï¼Œé¡¯ç¤ºè©³ç´°éŒ¯èª¤ä»¥ä¾›é™¤éŒ¯
            st.code(e)
